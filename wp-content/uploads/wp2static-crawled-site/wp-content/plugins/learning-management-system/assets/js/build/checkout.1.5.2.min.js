jQuery(function(i){if("undefined"==typeof _MASTERIYO_CHECKOUT_)return!1;var r={$form:i("form.masteriyo-checkout"),getAjaxURL:function(){return _MASTERIYO_CHECKOUT_.ajaxURL},getCheckoutURL:function(){return _MASTERIYO_CHECKOUT_.checkoutURL},init:function(){i(document.body).on("update_checkout",this.updateCheckout),i(document.body).on("init_checkout",this.initCheckout),this.$form.on("click",'input[name="payment_method"]',this.paymentMethodSelected),this.$form.attr("novalidate","novalidate"),this.$form.on("submit",this.submit),this.initPaymentMethods(),!0===_MASTERIYO_CHECKOUT_.is_checkout&&i(document.body).trigger("initCheckout")},initPaymentMethods:function(){var e=this.$form.find('input[name="payment_method"]');1===e.length&&e.eq(0).hide(),r.selectedPaymentMethod&&i("#"+r.selectedPaymentMethod).prop("checked",!0),0===e.filter(":checked").length&&e.eq(0).prop("checked",!0);var t=e.filter(":checked").eq(0).prop("id");1<e.length&&i('div.payment-box:not(".'+t+'")').filter(":visible").slideUp(0),e.filter(":checked").eq(0).trigger("click")},getPaymentMethod:function(){return this.$form.find('input[name="payment_method"]:checked').val()},paymentMethodSelected:function(e){e.stopPropagation(),1<i(".payment-methods input.input-radio").length?(t=i("div.payment-box."+i(this).attr("ID")),(e=i(this).is(":checked"))&&!t.is(":visible")&&(i("div.payment-box").filter(":visible").slideUp(230),e&&t.slideDown(230))):i("div.payment-box").show(),i(this).data("order_button_text")?i("#masteriyo-place-order").text(i(this).data("order_button_text")):i("#masteriyo-place-order").text(i("#masteriyo-place-order").data("value"));var t=i('.masteriyo-checkout input[name="payment_method"]:checked').attr("id");t!==this.selectedPaymentMethod&&i(document.body).trigger("paymentMethodSelected"),this.selectedPaymentMethod=t},initCheckout:function(){i(document.body).trigger("update_checkout")},resetUpdateCheckoutTimer:function(){clearTimeout(r.updateTimer)},isValidJson:function(e){try{var t=JSON.parse(e);return t&&"object"==typeof t}catch(e){return!1}},updateCheckout:function(e,t){r.resetUpdateCheckoutTimer(),r.updateTimer=setTimeout(r.updateCheckoutAction,"5",t)},handleUnloadEvent:function(e){if(-1===navigator.userAgent.indexOf("MSIE")&&!document.documentMode)return!0;e.preventDefault()},attachUnloadEventsOnSubmit:function(){i(window).on("beforeunload",this.handleUnloadEvent)},detachUnloadEventsOnSubmit:function(){i(window).off("beforeunload",this.handleUnloadEvent)},submitError:function(e){i(".masteriyo-NoticeGroup-checkout, .masteriyo-error, .masteriyo-message").remove(),r.$form.prepend('<div class="masteriyo-NoticeGroup masteriyo-NoticeGroup-checkout">'+e+"</div>"),r.$form.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),r.scrollToNotices(),i(document.body).trigger("checkout_error",[e])},scrollToNotices:function(){var e=i(".masteriyo-NoticeGroup-updateOrderReview, .masteriyo-NoticeGroup-checkout");(e=!e.length?i("form.masteriyo-checkout"):e).length&&i("html, body").animate({scrollTop:e.offset().top-100},1e3)},handleFormSubmissionFailure:function(e,t,o){r.detachUnloadEventsOnSubmit();try{error=e.responseJSON,r.submitError('<div class="masteriyo-error">'+error.data.messages+"</div>")}catch(e){console.log(e)}},handleFormSubmissionSuccess:function(t,e,o){r.detachUnloadEventsOnSubmit();try{if("success"!==t.result||!1===r.$form.triggerHandler("checkout_place_order_success",t))throw"failure"===t.result?"Result failure":"Invalid response";-1===t.redirect.indexOf("https://")||-1===t.redirect.indexOf("http://")?window.location=t.redirect:window.location=decodeURI(t.redirect)}catch(e){if(!0===t.reload)return void window.location.reload();!0===t.refresh&&i(document.body).trigger("update_checkout"),t.messages&&r.submitError(t.messages)}},submit:function(e){return console.log("Checkout form submission"),r.$form.is(".processing")||!1!==r.$form.triggerHandler("checkout_place_order")&&!1!==r.$form.triggerHandler("checkout_place_order_"+r.getPaymentMethod())&&(r.attachUnloadEventsOnSubmit(),i.ajax({type:"POST",url:r.getCheckoutURL(),dataType:"json",data:r.$form.serialize(),beforeSend:function(e){r.$form.addClass("processing").block({message:'<span class="spinner" style="visibility:visible"></span>',css:{border:"",width:"0%"},overlayCSS:{background:"#fff",opacity:.6}})},success:function(e,t,o){r.handleFormSubmissionSuccess(e,t,o)},error:function(e,t,o){r.handleFormSubmissionFailure(e,t,o)},complete:function(e,t){r.detachUnloadEventsOnSubmit(),r.$form.removeClass("processing").unblock()}})),!1}};r.init()});